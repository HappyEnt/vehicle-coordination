cmake_minimum_required(VERSION 3.0)

get_filename_component(LIBRARIES_PATH ${CMAKE_CURRENT_SOURCE_DIR} NAME)

if(NOT DEFINED ENV{WEBOTS_HOME})
  # Check whether /Applications/Webots.app exists
  if(EXISTS "/Applications/Webots.app")
    set(ENV{WEBOTS_HOME} "/Applications/Webots.app/Contents")
  else()
    message(FATAL_ERROR "WEBOTS_HOME environment variable is not set and /Applications/Webots.app does not exist.")
  endif()
endif()

link_directories("../../fast-particle-filter/pf/c_implementation/build")
include_directories("../../fast-particle-filter/pf/c_implementation")

# find_package(GSL REQUIRED)
set(Boost_USE_STATIC_LIBS OFF)
set(Boost_USE_MULTITHREADED ON)
set(Boost_USE_STATIC_RUNTIME OFF)

find_package(Boost COMPONENTS log log_setup thread system REQUIRED)

SET(CMAKE_ARCHIVE_OUTPUT_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR})

# Brew refuses to link openssl. Point OPENSSL_ROOT_DIR to correct location if on macos
if(APPLE AND CMAKE_SYSTEM_PROCESSOR MATCHES "arm64")
  # set OPENSSL_ROOT_DIR to correct path
  set(OPENSSL_ROOT_DIR "/opt/homebrew/opt/openssl")
  # set protobuf command
endif()

# Generate interface from protobuf definition
find_package(GRPC CONFIG REQUIRED)
find_package(Protobuf REQUIRED)

add_subdirectory(visualization)
add_subdirectory(motor-adapter)
add_subdirectory(pf-localization)

